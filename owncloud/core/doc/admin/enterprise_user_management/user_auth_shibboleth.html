
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Shibboleth Integration (Enterprise Subscription only) &mdash; ownCloud 8.2 Server Administration Manual 8.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '8.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <link rel="top" title="ownCloud 8.2 Server Administration Manual 8.2 documentation" href="../index.html" />
    <link rel="up" title="User Management (ES only)" href="index.html" />
    <link rel="next" title="Enabling Anonymous Uploads with Files Drop (ES Only)" href="../enterprise_files_drop/index.html" />
    <link rel="prev" title="User Management (ES only)" href="index.html" />
<script type="text/javascript">
(function () {
  /**
   * Patch TOC list.
   *
   * Will mutate the underlying span to have a correct ul for nav.
   *
   * @param $span: Span containing nested UL's to mutate.
   * @param minLevel: Starting level for nested lists. (1: global, 2: local).
   */
  var patchToc = function ($ul, minLevel) {
    var findA;

    // Find all a "internal" tags, traversing recursively.
    findA = function ($elem, level) {
      var level = level || 0,
        $items = $elem.find("> li > a.internal, > ul, > li > ul");

      // Iterate everything in order.
      $items.each(function (index, item) {
        var $item = $(item),
          tag = item.tagName.toLowerCase(),
          pad = 15 + ((level - minLevel) * 10);

        if (tag === 'a' && level >= minLevel) {
          // Add to existing padding.
          $item.css('padding-left', pad + "px");
          console.log(level, $item, 'padding-left', pad + "px");
        } else if (tag === 'ul') {
          // Recurse.
          findA($item, level + 1);
        }
      });
    };

    console.log("HERE");
    findA($ul);
  };

  $(document).ready(function () {
    // Add styling, structure to TOC's.
    $(".dropdown-menu").each(function () {
      $(this).find("ul").each(function (index, item){
        var $item = $(item);
        $item.addClass('unstyled');
      });
      $(this).find("li").each(function () {
        $(this).parent().append(this);
      });
    });

    // Patch in level.
    patchToc($("ul.globaltoc"), 2);
    patchToc($("ul.localtoc"), 2);

    // Enable dropdown.
    $('.dropdown-toggle').dropdown();
  });
}());
</script>

  </head>
  <body>
  

<div class="container">
  <div class="content">
    <div class="page-header">
      <h1><a href="../contents.html">ownCloud 8.2 Server Administration Manual</a></h1>

    </div>
    
			<div class="row">
				<div class="span3">
					<div class="sidebar">
						<div class="well">
							<div class="menu-support-container">
								<ul id="menu-support" class="menu">
									<ul>
										
<li><a href="../contents.html">Table of Contents</a></li>
									</ul>
                  <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">ownCloud 8.2 Server Administration Manual Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">ownCloud 8.2 Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../whats_new_admin.html">What&#8217;s New for Admins in ownCloud 8.2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_server/index.html">ownCloud Server Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_user/index.html">User Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_files/index.html">File Sharing and Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_database/index.html">Database Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration_mimetypes/index.html">Mimetypes Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintenance/index.html">Maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operations/index.html">Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../issues/index.html">Issues and Troubleshooting</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../enterprise_installation/index.html">Enterprise Subscription Installation (ES Only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_clients/index.html">Creating Branded ownCloud Clients (ES only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_server_branding/index.html">Enterprise Server Branding (ES only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_external_storage/index.html">External Storage (ES only)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Management (ES only)</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Shibboleth Integration (Enterprise Subscription only)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#apache-configuration">Apache Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enabling-configurating-the-shibboleth-app">Enabling &amp; Configurating the Shibboleth App</a></li>
<li class="toctree-l3"><a class="reference internal" href="#webdav-support">WebDAV Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="#known-limitations">Known Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#encryption">Encryption</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-login-mechanisms">Other Login Mechanisms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#session-timeout">Session Timeout</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uid-considerations-and-windows-network-drive-compatability">UID Considerations and Windows Network Drive compatability</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../enterprise_files_drop/index.html">Enabling Anonymous Uploads with Files Drop (ES Only)</a></li>
</ul>

								</ul>
							</div>
						</div>
					</div>
				</div>
        

				<div class="span9">
					<div class="page-content">
						
  <div class="section" id="shibboleth-integration-enterprise-subscription-only">
<h1>Shibboleth Integration (Enterprise Subscription only)<a class="headerlink" href="#shibboleth-integration-enterprise-subscription-only" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The ownCloud Shibboleth user backend application integrates ownCloud with a
Shibboleth Service Provider (SP) and allows operations in federated and
single-sign-on infrastructures. Setting up Shibboleth has three steps:</p>
<ol class="arabic simple">
<li>Create the appropriate Apache configuration.</li>
<li>Enable the Shibboleth app.</li>
<li>Map Shibboleth environment variables to ownCloud attributes.</li>
</ol>
<p>Currently supported installations are based on the <a class="reference external" href="https://wiki.shibboleth.net/confluence/display/SHIB2/NativeSPApacheConfig">native Apache integration</a>
. The individual configuration of the service provider is highly dependent on
the operating system, as well as on the integration with the Identity
Providers (IdP), and require case-by-case analysis and installation.</p>
<p>The ownCloud Desktop Client can interact with an
ownCloud instance running inside a Shibboleth Service Provider by using built-in
browser components for authentication against the IdP.</p>
<p>The regular ownCloud Android and iOS mobile apps do not work with Shibboleth.
However, customers who create
<a class="reference internal" href="../enterprise_clients/creating_branded_apps.html"><em>branded mobile apps with ownBrander</em></a>
have the option to enable SAML authentication in ownBrander.</p>
<p>Enterprise customers also have the option to request a regular ownCloud
mobile client built to use Shibboleth from their ownCloud account
representatives.</p>
<p>The ownCloud desktop sync client and mobile apps store users&#8217; logins, so
your users only need to enter their logins the first time they set up their
accounts.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The ownCloud clients may use only a single Shibboleth login per
ownCloud server; multi-account is not supported with Shibboleth.</p>
</div>
<p>These screenshots show what the user sees at account setup. Figure 1
shows a test Shibboleth login screen from
<a class="reference external" href="https://www.testshib.org/index.html">Testshib.org</a> on the ownCloud desktop
sync client.</p>
<div class="figure">
<img alt="First client login screen." src="../_images/shib-gui1.png" />
<p class="caption"><em>figure 1: First login screen</em></p>
</div>
<p>Then after going through the setup wizard, the desktop sync client displays the
server and login information just like it does for any other ownCloud server
connections.</p>
<div class="figure">
<img alt="The ownCloud client shows which server you are connected to." src="../_images/shib-gui4.png" />
<p class="caption"><em>figure 2: ownCloud client displays server information</em></p>
</div>
<p>To your users, it doesn&#8217;t look or behave differently on the desktop sync
client, Android app, or iOS app from an ordinary ownCloud account setup. The
only difference is the initial setup screen where they enter their account
login.</p>
</div>
<div class="section" id="apache-configuration">
<h2>Apache Configuration<a class="headerlink" href="#apache-configuration" title="Permalink to this headline">¶</a></h2>
<p>This is an example configuration as installed and operated on a Linux server
running the Apache Web server. These configurations are highly operating system
specific and require a high degree of customization.</p>
<p>The ownCloud instance itself is installed in <tt class="docutils literal"><span class="pre">/var/www/owncloud/</span></tt>.  The
following aliases are defined in an Apache virtual host directive:</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="c"># non-Shibboleth access</span>
<span class="nb">Alias</span> <span class="sx">/owncloud</span> <span class="sx">/var/www/owncloud/</span>
<span class="c"># for Shibboleth access</span>
<span class="nb">Alias</span> <span class="sx">/oc-shib</span> <span class="sx">/var/www/owncloud/</span>
</pre></div>
</div>
<p>Further Shibboleth specific configuration as defined in
<tt class="docutils literal"><span class="pre">/etc/apache2/conf.d/shib.conf</span></tt>:</p>
<div class="highlight-apache"><pre>    #
    # Load the Shibboleth module.
    #
    LoadModule mod_shib /usr/lib64/shibboleth/mod_shib_22.so

    #
    # Ensures handler will be accessible.
    #
    &lt;Location /Shibboleth.sso&gt;
      Satisfy Any
      Allow from all
    &lt;/Location&gt;

    #
    # Configure the module for content.
    #
    # Shibboleth is disabled for the following location to allow non
    # shibboleth webdav access
    &lt;Location ~ "/oc-shib/remote.php/nonshib-webdav"&gt;
      Satisfy Any
      Allow from all
      AuthType None
      Require all granted
    &lt;/Location&gt;

    # Shibboleth is disabled for the following location to allow public link
    # sharing
    &lt;Location ~
      "/oc-shib/(status.php$
      |index.php/s/
      |public.php$
      |cron.php$
      |core/img/
      |index.php/apps/files_sharing/ajax/publicpreview.php$
      |index.php/apps/files/ajax/upload.php$
      |apps/files/templates/fileexists.html$
      |index.php/apps/files/ajax/mimeicon.php$)"&gt;
      Satisfy Any
      Allow from all
      AuthType None
      Require all granted
    &lt;/Location&gt;

    # Shibboleth is disabled for the following location to allow public gallery
# sharing
    &lt;Location ~
     "/oc-shib/(apps/gallery/templates/slideshow.html$
     |index.php/apps/gallery/ajax/getimages.php
     |index.php/apps/gallery/ajax/thumbnail.php
     |index.php/apps/gallery/ajax/image.php)"&gt;
      Satisfy Any
      Allow from all
      AuthType None
      Require all granted
    &lt;/Location&gt;

    # Shibboleth is disabled for the following location to allow public link
    # sharing
    &lt;Location ~ "/oc-shib/.*\.css"&gt;
      Satisfy Any
      Allow from all
      AuthType None
      Require all granted
    &lt;/Location&gt;

    # Shibboleth is disabled for the following location to allow public link
    # sharing
    &lt;Location ~ "/oc-shib/.*\.js"&gt;
      Satisfy Any
      Allow from all
      AuthType None
      Require all granted
    &lt;/Location&gt;

    # Shibboleth is disabled for the following location to allow public link
    # sharing
    &lt;Location ~ "/oc-shib/.*\.woff "&gt;
      Satisfy Any
      Allow from all
      AuthType None
      Require all granted
    &lt;/Location&gt;

    # Besides the exceptions above this location is now under control of
    # Shibboleth
    &lt;Location /oc-shib&gt;
      AuthType shibboleth
      ShibRequireSession On
      ShibUseHeaders Off
      ShibExportAssertion On
      require valid-user
    &lt;/Location&gt;</pre>
</div>
</div>
<div class="section" id="enabling-configurating-the-shibboleth-app">
<h2>Enabling &amp; Configurating the Shibboleth App<a class="headerlink" href="#enabling-configurating-the-shibboleth-app" title="Permalink to this headline">¶</a></h2>
<p>You must enable the Shibboleth app on your Apps page, and then select the mode
you want Shibboleth to operate in from the dropdown on your Admin page, either
<strong>Autoprovision Users</strong> or <strong>Single sign-on only</strong>.</p>
<div class="figure">
<img alt="Shibboleth configuration screen." src="../_images/shib-gui5.png" />
<p class="caption"><em>figure 3: Enabling Shibboleth on the Admin page</em></p>
</div>
<p>In ownCloud 8.1 the Shibboleth variables were stored in
<tt class="docutils literal"><span class="pre">apps/user_shibboleth/config.php</span></tt>. This file was overwritten on upgrades. In
ownCloud 8.2 the variables are stored in the ownCloud database, so Shibboleth
is now automatically upgradeable.</p>
<p>After installing and enabling the Shibboleth application there are four
Shibboleth environment configuration variables to map to ownCloud user
attributes.</p>
<div class="figure">
<img alt="Dropdowns for mapping Shibboleth environment configuration variables to ownCloud user attributes." src="../_images/shib-gui6.png" />
<p class="caption"><em>figure 4: Mapping Shibboleth environment configuration variables to ownCloud user attributes</em></p>
</div>
</div>
<div class="section" id="webdav-support">
<h2>WebDAV Support<a class="headerlink" href="#webdav-support" title="Permalink to this headline">¶</a></h2>
<p>Users of standard WebDAV clients can use an alternative
WebDAV Url, for example <tt class="docutils literal"><span class="pre">https://cloud.example.com/remote.php/nonshib-webdav/</span></tt>
to log in with their username and password. The password is generated on the
Personal settings page.</p>
<img alt="../_images/shibboleth-personal.png" src="../_images/shibboleth-personal.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In pure SSO mode the WebDAV password feature will not work, as we
have no way to store the WebDAV password. It does work in auto-provision
mode.</p>
</div>
<p>For provisioning purpose an OCS API has been added to revoke a generated
password for a user:</p>
<p>Syntax: <tt class="docutils literal"><span class="pre">/v1/cloud/users/{userid}/non_shib_password</span></tt></p>
<ul class="simple">
<li>HTTP method: DELETE</li>
</ul>
<p>Status codes:</p>
<ul class="simple">
<li>100 - successful</li>
<li>998 - user unknown</li>
</ul>
<p>Example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>curl -X DELETE <span class="s2">&quot;https://cloud.example.com/ocs/v1.php/cloud/users/myself@testshib.org/non_shib_password&quot;</span> -u admin:admin
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span>?&gt;
&lt;ocs&gt;
 &lt;meta&gt;
  &lt;status&gt;ok&lt;/status&gt;
  &lt;statuscode&gt;100&lt;/statuscode&gt;
  &lt;message/&gt;
 &lt;/meta&gt;
 &lt;data/&gt;
&lt;/ocs&gt;
</pre></div>
</div>
</div>
<div class="section" id="known-limitations">
<h2>Known Limitations<a class="headerlink" href="#known-limitations" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="encryption">
<h2>Encryption<a class="headerlink" href="#encryption" title="Permalink to this headline">¶</a></h2>
<p>File encryption can not be used together with Shibboleth because the encryption
requires the user&#8217;s password to unlock the private encryption key. Due to the
nature of Shibboleth the user&#8217;s password is not known to the service provider.
Currently, we have no solution to this limitation.</p>
</div>
<div class="section" id="other-login-mechanisms">
<h2>Other Login Mechanisms<a class="headerlink" href="#other-login-mechanisms" title="Permalink to this headline">¶</a></h2>
<p>Shibboleth is not compatible with any other ownCloud user backend because the
login process is handled outside of ownCloud.</p>
<p>You can allow other login mechanisms (e.g. LDAP or ownCloud native) by creating
a second Apache virtual host configuration. This second location is not
protected by Shibboleth, and you can use your other ownCloud login mechanisms.</p>
</div>
<div class="section" id="session-timeout">
<h2>Session Timeout<a class="headerlink" href="#session-timeout" title="Permalink to this headline">¶</a></h2>
<p>Session timeout on Shibboleth is controlled by the IdP. It is not possible to
have a session length longer than the length controlled by the IdP. In extreme
cases this could result in re-login on mobile clients and desktop clients every
hour.</p>
<p>The session timeout can be overridden in the service provider, but this
requires a source code change of the Apache Shibboleth module. A patch can be
provided by the ownCloud support team.</p>
</div>
<div class="section" id="uid-considerations-and-windows-network-drive-compatability">
<h2>UID Considerations and Windows Network Drive compatability<a class="headerlink" href="#uid-considerations-and-windows-network-drive-compatability" title="Permalink to this headline">¶</a></h2>
<p>When using <tt class="docutils literal"><span class="pre">user_shibboleth</span></tt> in single-sign on (SSO) only mode, together with
<tt class="docutils literal"><span class="pre">user_ldap</span></tt>, both apps need to resolve to the same <tt class="docutils literal"><span class="pre">uid</span></tt>.
<tt class="docutils literal"><span class="pre">user_shibboleth</span></tt> will do the authentication, and <tt class="docutils literal"><span class="pre">user_ldap</span></tt> will provide
user details such as <tt class="docutils literal"><span class="pre">email</span></tt> and <tt class="docutils literal"><span class="pre">displayname</span></tt>. In the case of Active
Directory, multiple attributes can be used as the <tt class="docutils literal"><span class="pre">uid</span></tt>. But they all have
different implications to take into account.</p>
<div class="section" id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h3>
<p><strong>sAMAccountName</strong></p>
<ul class="simple">
<li><em>Example:</em> jfd</li>
<li><em>Uniqueness:</em> Domain local, might change e.g. marriage</li>
<li><em>Other implications:</em> Works with <tt class="docutils literal"><span class="pre">windows_network_drive</span></tt> app</li>
</ul>
<p><strong>userPrincipalName</strong></p>
<ul class="simple">
<li><em>Example:</em> <a class="reference external" href="mailto:jfd&#37;&#52;&#48;owncloud&#46;com">jfd<span>&#64;</span>owncloud<span>&#46;</span>com</a></li>
<li><em>Uniqueness:</em> Forest local, might change on eg. marriage</li>
<li><em>Other implications:</em> TODO check WND compatability</li>
</ul>
<p><strong>objectSid</strong></p>
<ul class="simple">
<li><em>Example:</em> S-1-5-21-2611707862-2219215769-354220275-1137</li>
<li><em>Uniqueness:</em> Domain local, changes when the user is moved to a new domain</li>
<li><em>Other implications:</em> Incompatible with <tt class="docutils literal"><span class="pre">windows_network_drive</span></tt> app</li>
</ul>
<p><strong>sIDHistory</strong></p>
<ul class="simple">
<li><em>Example:</em> Multi-value</li>
<li><em>Uniqueness:</em> Contains previous objectSIDs</li>
<li><em>Other implications:</em> Incompatible with <tt class="docutils literal"><span class="pre">windows_network_drive</span></tt> app</li>
</ul>
<p><strong>objectGUID</strong></p>
<ul class="simple">
<li><em>Example:</em> 47AB881D-0655-414D-982F-02998C905A28</li>
<li><em>Uniqueness:</em> Globally unique</li>
<li><em>Other implications:</em> Incompatible with <tt class="docutils literal"><span class="pre">windows_network_drive</span></tt> app</li>
</ul>
<p>Keep in mind that ownCloud will derive the home folder from the <tt class="docutils literal"><span class="pre">uid</span></tt>, unless
a home folder naming rule is in place. The only truly stable attribute is the
<tt class="docutils literal"><span class="pre">objectGUID</span></tt>, so that should be used. If not for the <tt class="docutils literal"><span class="pre">uid</span></tt> then at least as
the home folder naming rule. The tradeoff here is that if you want to use
<tt class="docutils literal"><span class="pre">windows_network_drive</span></tt> you are bound to the <tt class="docutils literal"><span class="pre">sAMAccountName</span></tt>, as that is
used as the login.</p>
<p>Also be aware that using <tt class="docutils literal"><span class="pre">user_shibboleth</span></tt> in Autoprovisioning mode will not
allow you to use SSO for your <tt class="docutils literal"><span class="pre">user_ldap</span></tt> users, because <tt class="docutils literal"><span class="pre">uid</span></tt> collisions
will be detected by <tt class="docutils literal"><span class="pre">user_ldap</span></tt>.</p>
</div>
</div>
</div>


					</div>
				</div>
			</div>
    
  </div>
</div>
  </body>
</html>